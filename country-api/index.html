<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="297466.png" type="image/png">
    <link rel="stylesheet" href="style.css">

    <title>Global Country Directory</title>

    <style>
        body {
            background-color: black;
            color: white;
            padding: 20px; /* Added padding for a better visual buffer */
        }

        h1 {
            text-align: center;
            margin: 0;
            font-family: 'felipa', 'Times New Roman', Times, serif;
            background-color:black;
            padding-left: 30px;
            padding-right:30px;
        }

        h3 {
            text-align: center;
            font-family: "DM Serif Text", serif;
        }

        hr {
             margin-top: 10px; 
            margin-bottom: 10px; 
            
        }

        .content img {
            width: 100%;
            height: auto;
            object-fit: cover;
            
        }

        h2 {
            font-family: 'felipa', 'Times New Roman', Times, serif;
        }

        p {
            font-family: "DM Serif Text", serif;
        }

        
        .container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            justify-content: space-around; 
        }

        .content {
            flex: 1 1 300px; /* Allows up to 3 columns on wide screens */
            padding: 15px;
            background-color: #333; /* Slightly lighter background for contrast */
           
        }

        .ccontent {
            flex: 1 1 45%; /* Used for the two-column transportation layout */
            padding: 15px;
            background-color: #333;
           
        }

        iframe {
            width: 100%;
            height: 300px;
            
        }
        
        .country-banner {
            height: 350px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #1a1a1a;
            background-repeat: no-repeat;
            background-size: cover; 
            background-position: center;
        }

        .country-section {
            padding: 20px 0;
            margin-bottom: 40px;
        }
    </style>
</head>

<body>
    <nav class="navbar" style="text-align: center; margin-bottom: 20px;">
        <a href="#dynamic-cities">Cities</a>
        <a href="#dynamic-maps">Maps</a>
        <a href="#dynamic-trans">Transportation</a>
    </nav>
    
    <div id="main-content">
        <p style="text-align: center;">Loading country data...</p>
    </div>

    <script>
        // Ensure your Python server is running with 'uvicorn main:app --reload'
        const API_URL = 'http://127.0.0.1:8000/countries';

        async function renderCountryData() {
            const mainContainer = document.getElementById('main-content');
            mainContainer.innerHTML = ''; // Clear loading message

            try {
                // 1. Fetch data from the FastAPI endpoint
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                // 2. Parse the JSON response
                const countries = await response.json(); 

                // 3. Iterate over each country
                countries.forEach(country => {
                    const countrySlug = country.name.toLowerCase().replace(/\s/g, '-');
                    const backimage = country['background-image-url'];
                    const cityNames = country.top_cities.map(city => city.city_name).join(', ');

                    // Start HTML construction for a single country, adopting australia.html structure
                    let countryHtml = '';

                    // --- Country Header (Simplified Banner) ---
                    countryHtml += `
                        <div class="country-section">
                            <div class="country-banner" style="background-image: url('${backimage}');">
                                <h1>${country.name}</h1>
                            </div>
                            <hr>
                            <h3>Some of the most visited cities are: ${cityNames}</h3>
                            <hr>
                    `;

                    // --- 3.1. Cities Section ---
                    countryHtml += `<h1 style="text-align: center;" id="dynamic-cities">Top Cities in ${country.name}</h1>`;
                    countryHtml += `<div class="container">`;
                    
                    country.top_cities.forEach((city, index) => {
                        // Extract details, providing fallback text for empty fields
                        const details = city.details;
                        const annualTourists = details['annual tourists'] || 'N/A';
                        const popularAttractions = (details['popular attractions'] && details['popular attractions'].length > 0)
                            ? details['popular attractions'].join(', ') 
                            : 'N/A';
                        const imageUrl = details['image-url'] || '#';
                        const firstCityId = (index === 0) ? `id="${city.city_name.toLowerCase().replace(/\s/g, '-')}"` : '';

                        countryHtml += `
                            <div class="content" ${firstCityId}>
                                <h2>${city.city_name}</h2>
                                <br>
                                <p>
                                    <b>Annual Tourists: </b> ${annualTourists} <br>
                                    <br><b>Most Popular Attractions: </b>${popularAttractions}
                                    </p>
                                <br>
                                <img src="${imageUrl}" alt="${city.city_name}">
                            </div>
                        `;
                    });
                    countryHtml += `</div>`; // Close City container


                    // --- 3.2. Maps Section ---
                    countryHtml += `<hr><h1 style="text-align: center;margin-bottom:10px;" id="dynamic-maps">Maps for Each City</h1>`;
                    countryHtml += `<div class="container">`;
                    
                    country.top_cities.forEach(city => {
                        // The map-url contains the full <iframe> tag from your JSON
                        const mapIframe = city.details["map-url"] || '<p>Map not available</p>';

                        countryHtml += `
                            <div class="content">
                                <h2>${city.city_name}</h2>
                                <br>
                                ${mapIframe}
                            </div>
                        `;
                    });
                    countryHtml += `</div>`; // Close Maps container

                    // --- 3.3. Transportation Section ---
                    countryHtml += `<hr><h1 style="margin-bottom:10px;" id="dynamic-trans">Transportation Tips</h1>`;
                    countryHtml += `<div class="container">`;

                    // Aggregate Airport Tips from all cities
                    let airportTips = `<h2>Airport</h2><br><p>`;
                    country.top_cities.forEach(city => {
                        const tip = city.details.transportation.airport || 'Information not available.';
                        airportTips += `<b>${city.city_name}:</b> ${tip} <br><br>`;
                    });
                    airportTips += `</p>`;

                    // Aggregate Local Transport Tips from all cities
                    let publicTips = `<h2>Local Public Transport</h2><br><p>`;
                    country.top_cities.forEach(city => {
                        const taxi = city.details.transportation.taxi || 'N/A';
                        const buses = city.details.transportation.buses || 'N/A';
                        const walking = city.details.transportation.walking || 'N/A';
                        
                        publicTips += `
                            <b>${city.city_name}</b><br>
                            <b>Taxi/Rideshares: </b>${taxi}<br>
                            <b>Buses: </b>${buses}<br>
                            <b>Walking: </b>${walking}<br>
                            <br>
                        `;
                    });
                    publicTips += `</p>`;

                    // Insert the two transportation content blocks using the ccontent class
                    countryHtml += `<div class="ccontent">${airportTips}</div>`;
                    countryHtml += `<div class="ccontent">${publicTips}</div>`;

                    countryHtml += `</div>`; // Close Transportation container
                    countryHtml += `</div>`; // Close Country Section wrapper

                    // Append the entire country's HTML to the main page
                    mainContainer.innerHTML += countryHtml;
                });

            } catch (error) {
                console.error('Error fetching data:', error);
                mainContainer.innerHTML = '<p style="color:red; text-align:center;">Failed to connect to the API. Make sure your Python server is running with: **uvicorn main:app --reload**</p>';
            }
        }

        renderCountryData();
    </script>
</body>

</html>